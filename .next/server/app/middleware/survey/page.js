(()=>{var e={};e.id=275,e.ids=[275],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},35900:e=>{"use strict";e.exports=require("pg")},6113:e=>{"use strict";e.exports=require("crypto")},6005:e=>{"use strict";e.exports=require("node:crypto")},71017:e=>{"use strict";e.exports=require("path")},57310:e=>{"use strict";e.exports=require("url")},91566:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>d.a,__next_app__:()=>f,originalPathname:()=>u,pages:()=>l,routeModule:()=>b,tree:()=>i}),t(30127),t(17338),t(32029),t(35866);var s=t(23191),a=t(88716),n=t(37922),d=t.n(n),o=t(95231),c={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>o[e]);t.d(r,c);let i=["",{children:["middleware",{children:["survey",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,30127)),"C:\\Users\\dhgupta\\Desktop\\HRSquared\\src\\app\\middleware\\survey\\page.tsx"]}]},{}]},{error:[()=>Promise.resolve().then(t.bind(t,17338)),"C:\\Users\\dhgupta\\Desktop\\HRSquared\\src\\app\\middleware\\error.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,32029)),"C:\\Users\\dhgupta\\Desktop\\HRSquared\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],l=["C:\\Users\\dhgupta\\Desktop\\HRSquared\\src\\app\\middleware\\survey\\page.tsx"],u="/middleware/survey/page",f={require:t,loadChunk:()=>Promise.resolve()},b=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/middleware/survey/page",pathname:"/middleware/survey",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:i}})},59007:(e,r,t)=>{let s={"08893cc7b3568853778612b7009d9e0295b3d182":()=>Promise.resolve().then(t.bind(t,29115)).then(e=>e.getUserIdFromClerkId),"3b9f5381daf25ec350eef41c4522b870a90edcf5":()=>Promise.resolve().then(t.bind(t,29115)).then(e=>e.createUser),"605fbd3cfa84bd30ec8d022f83bc673e1209f363":()=>Promise.resolve().then(t.bind(t,29115)).then(e=>e.checkUserPermissionForSurvey),"9e55bf1e1fc4c00ed7818ab82e1f39f596a869a4":()=>Promise.resolve().then(t.bind(t,29115)).then(e=>e.userCreationFlow),ad3fa980eb29ddc5515b6c81a8dd845a5595ed1c:()=>Promise.resolve().then(t.bind(t,29115)).then(e=>e.getAllUsers),ae096b2f57a48498d952cabcd0d481c0bea6f80f:()=>Promise.resolve().then(t.bind(t,29115)).then(e=>e.checkUserExistence),c3efeaa8e756ca8251d4d7c13b18b0fc263ca573:()=>Promise.resolve().then(t.bind(t,29115)).then(e=>e.getAllUsersToAssign),c44f796dddee508d2690c0a56bfa35105b4ef06e:()=>Promise.resolve().then(t.bind(t,29115)).then(e=>e.getUsersFormData),c5c87f63730f10b32f23532552f606c5ce927141:()=>Promise.resolve().then(t.bind(t,29115)).then(e=>e.updateUserRoleMapping),e2140fb79d9b1206cc77a6622598a189ef464d00:()=>Promise.resolve().then(t.bind(t,29115)).then(e=>e.getUserById),e2efa07395f6b5eef3b6d2f6bae60b4780d1f3ed:()=>Promise.resolve().then(t.bind(t,29115)).then(e=>e.getUserFromDb)};async function a(e,...r){return(await s[e]()).apply(null,r)}e.exports={"08893cc7b3568853778612b7009d9e0295b3d182":a.bind(null,"08893cc7b3568853778612b7009d9e0295b3d182"),"3b9f5381daf25ec350eef41c4522b870a90edcf5":a.bind(null,"3b9f5381daf25ec350eef41c4522b870a90edcf5"),"605fbd3cfa84bd30ec8d022f83bc673e1209f363":a.bind(null,"605fbd3cfa84bd30ec8d022f83bc673e1209f363"),"9e55bf1e1fc4c00ed7818ab82e1f39f596a869a4":a.bind(null,"9e55bf1e1fc4c00ed7818ab82e1f39f596a869a4"),ad3fa980eb29ddc5515b6c81a8dd845a5595ed1c:a.bind(null,"ad3fa980eb29ddc5515b6c81a8dd845a5595ed1c"),ae096b2f57a48498d952cabcd0d481c0bea6f80f:a.bind(null,"ae096b2f57a48498d952cabcd0d481c0bea6f80f"),c3efeaa8e756ca8251d4d7c13b18b0fc263ca573:a.bind(null,"c3efeaa8e756ca8251d4d7c13b18b0fc263ca573"),c44f796dddee508d2690c0a56bfa35105b4ef06e:a.bind(null,"c44f796dddee508d2690c0a56bfa35105b4ef06e"),c5c87f63730f10b32f23532552f606c5ce927141:a.bind(null,"c5c87f63730f10b32f23532552f606c5ce927141"),e2140fb79d9b1206cc77a6622598a189ef464d00:a.bind(null,"e2140fb79d9b1206cc77a6622598a189ef464d00"),e2efa07395f6b5eef3b6d2f6bae60b4780d1f3ed:a.bind(null,"e2efa07395f6b5eef3b6d2f6bae60b4780d1f3ed")}},61592:(e,r,t)=>{Promise.resolve().then(t.bind(t,85072)),Promise.resolve().then(t.bind(t,16566)),Promise.resolve().then(t.bind(t,91721)),Promise.resolve().then(t.bind(t,72248))},49654:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,12994,23)),Promise.resolve().then(t.t.bind(t,96114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,79671,23)),Promise.resolve().then(t.t.bind(t,41868,23)),Promise.resolve().then(t.t.bind(t,84759,23))},75215:(e,r,t)=>{Promise.resolve().then(t.bind(t,57860))},25136:(e,r,t)=>{Promise.resolve().then(t.bind(t,13171))},57860:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>a});var s=t(10326);function a(){return s.jsx("div",{className:"grid h-screen px-4 bg-white place-content-center",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("h1",{className:"font-black text-gray-200 text-9xl",children:"401"}),s.jsx("p",{className:"text-2xl font-bold tracking-tight text-gray-900 sm:text-4xl",children:"Unauthroized!"}),s.jsx("p",{className:"mt-4 text-gray-500",children:"Your link doesn't seem fine"})]})})}},13171:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>i});var s=t(10326),a=t(17577),n=t(35047),d=t(57860),o=t(45038),c=t(93092);function i(){let{user:e}=(0,o.aF)(),r=(0,n.useSearchParams)().get("id"),t=(0,n.useRouter)(),[i,l]=(0,a.useState)(!1);return console.log(r),console.log(e),e||console.log("no user"),r?(0,c._X)(r,e.id?e.id:null)?(console.log("pushed"),t.push(`/user/survey/${r}`)):console.log("user id not allowed not found"):console.log("userid found"),s.jsx("div",{children:i&&s.jsx(d.default,{})})}},93092:(e,r,t)=>{"use strict";t.d(r,{BF:()=>n,_X:()=>a}),t(15424);var s=t(46242),a=(0,s.$)("605fbd3cfa84bd30ec8d022f83bc673e1209f363");(0,s.$)("e2efa07395f6b5eef3b6d2f6bae60b4780d1f3ed"),(0,s.$)("ad3fa980eb29ddc5515b6c81a8dd845a5595ed1c"),(0,s.$)("c3efeaa8e756ca8251d4d7c13b18b0fc263ca573"),(0,s.$)("e2140fb79d9b1206cc77a6622598a189ef464d00");var n=(0,s.$)("c5c87f63730f10b32f23532552f606c5ce927141");(0,s.$)("c44f796dddee508d2690c0a56bfa35105b4ef06e"),(0,s.$)("3b9f5381daf25ec350eef41c4522b870a90edcf5"),(0,s.$)("ae096b2f57a48498d952cabcd0d481c0bea6f80f"),(0,s.$)("9e55bf1e1fc4c00ed7818ab82e1f39f596a869a4"),(0,s.$)("08893cc7b3568853778612b7009d9e0295b3d182")},32029:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c,metadata:()=>o});var s=t(19510),a=t(25384),n=t.n(a);t(5023);var d=t(7311);let o={title:"Home",description:"Generated by create next app"};async function c({children:e}){return s.jsx(d.El,{children:s.jsx("html",{lang:"en",children:s.jsx("body",{className:n().className,children:e})})})}},17338:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>d,__esModule:()=>n,default:()=>o});var s=t(68570);let a=(0,s.createProxy)(String.raw`C:\Users\dhgupta\Desktop\HRSquared\src\app\middleware\error.tsx`),{__esModule:n,$$typeof:d}=a;a.default;let o=(0,s.createProxy)(String.raw`C:\Users\dhgupta\Desktop\HRSquared\src\app\middleware\error.tsx#default`)},30127:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>d,__esModule:()=>n,default:()=>o});var s=t(68570);let a=(0,s.createProxy)(String.raw`C:\Users\dhgupta\Desktop\HRSquared\src\app\middleware\survey\page.tsx`),{__esModule:n,$$typeof:d}=a;a.default;let o=(0,s.createProxy)(String.raw`C:\Users\dhgupta\Desktop\HRSquared\src\app\middleware\survey\page.tsx#default`)},94054:(e,r,t)=>{"use strict";let s;t.d(r,{dbConnect:()=>o});var a=t(35900);let{Pool:n}=t.n(a)(),d=new n({user:"tmsdb_stli_user",password:"e9xMpaWVMWOG6mepVfFQd8uY6XaUDv4F",host:"dpg-cof58cocmk4c7380j3l0-a.oregon-postgres.render.com",database:"tmsdb_stli",ssl:!0}),o=async()=>s||(s=await d.connect())},29115:(e,r,t)=>{"use strict";t.r(r),t.d(r,{checkUserExistence:()=>b,checkUserPermissionForSurvey:()=>v,createUser:()=>f,getAllUsers:()=>o,getAllUsersToAssign:()=>c,getUserById:()=>i,getUserFromDb:()=>d,getUserIdFromClerkId:()=>g,getUsersFormData:()=>u,updateUserRoleMapping:()=>l,userCreationFlow:()=>p});var s=t(27745);t(26461);var a=t(74739),n=t(94054);async function d(e,r){let t={text:`select u.id, u.username, u.email, r.rolename
        from users u
        left join userrole_mapping um
        on u.id = um.user_id
        left join roles r
        on um.role_id = r.id
        where u.email=$1 and password=$2;`,values:[e,r]},s=await (0,n.dbConnect)(),d=await s.query(t);if(d.rowCount>0)return d.rows;(0,a.notFound)()}async function o(){let e=`
    select users.id, users.username, users.email, roles.rolename, groups.groupname, category.categoryname, um.can_create_survey
    from userrole_mapping um
    left join users on users.id = um.user_id
    left join roles on roles.id = um.role_id
    left join groups on groups.id = um.group_id
    left join category on category.id = um.category_id
    where users.isActive = true;`,r=await (0,n.dbConnect)(),t=await r.query(e);if(t.rowCount>0)return t.rows;(0,a.notFound)()}async function c(){let e=await (0,n.dbConnect)(),r=await e.query("select u.id, u.username, u.email from users u;");if(r.rowCount>0)return r.rows;(0,a.notFound)()}async function i(e){let r={text:`
        select users.id, users.username, users.email, roles.rolename, groups.groupname, category.categoryname, um.can_create_survey
        from userrole_mapping um
        left join users on users.id = um.user_id
        left join roles on roles.id = um.role_id
        left join groups on groups.id = um.group_id
        left join category on category.id = um.category_id
        where users.isActive = true and users.id=$1`,values:[e]},t=await (0,n.dbConnect)(),s=await t.query(r);if(s.rowCount>0)return s.rows;(0,a.notFound)()}async function l(e){let r={text:`update userrole_mapping
    set role_id=$1, group_id=$2, category_id=$3,can_create_survey=$4
    where user_id=$5`,values:[e.role_id,e.group_id,e.category_id,e.can_create_survey,e.user_id]};try{let e=await (0,n.dbConnect)();await e.query(r)}catch(e){console.log(e),(0,a.notFound)()}}async function u(){let e=await (0,n.dbConnect)(),r=await e.query("select * from roles"),t=await e.query("select * from groups"),s=await e.query("select * from category");return{roles:r.rows,groups:t.rows,categories:s.rows}}async function f(e){let r=await (0,n.dbConnect)(),t={text:"insert into users (username, email, password, isactive, clerk_id) values ($1, $2, $3, $4, $5)",values:[e.username,e.email,e.password,e.isactive,e.clerk_id]};return(await r.query(t)).rows}async function b(e){let r=await (0,n.dbConnect)();return 0!=(await r.query({text:"select clerk_id from users where clerk_id=$1",values:[e]})).rows.length&&(console.log("user already exists"),!0)}async function m(e){if(!e)return;let r={username:`${e.firstName} ${e.lastName}`,email:`${e.emailAddresses[0].emailAddress}`,password:"clerk",isactive:!0,clerk_id:e.id};console.log(r),f(r)}async function p(e){if(e||console.log("user does not exist"),!await b(e.id))return m(e),"creating user"}async function g(e){let r=await (0,n.dbConnect)(),t=await r.query({text:'select id from "users" where clerk_id=$1',values:[e]});return null==t.rows[0].id?1:t.rows[0].id}async function v(e,r){if(null==r)return(0,a.notFound)();let t=await (0,n.dbConnect)(),s=await g(r);console.log("permission actual user id: ",s);let d=await t.query({text:"select category from surveys where id=$1",values:[e]});if(d.rows[0]?.category==null)return!0;let o={text:`select urm.id 
    from userrole_mapping urm
    join surveys s on s.category = urm.group_id
    where urm.user_id = $1  and s.id = $2
    `,values:[s,e]},c=await t.query(o);return console.log("***************this is result",c),c.rowCount>0}(0,t(85723).ensureServerEntryExports)([d,o,c,i,l,u,f,b,p,g,v]),(0,s.registerServerReference)("e2efa07395f6b5eef3b6d2f6bae60b4780d1f3ed",d),(0,s.registerServerReference)("ad3fa980eb29ddc5515b6c81a8dd845a5595ed1c",o),(0,s.registerServerReference)("c3efeaa8e756ca8251d4d7c13b18b0fc263ca573",c),(0,s.registerServerReference)("e2140fb79d9b1206cc77a6622598a189ef464d00",i),(0,s.registerServerReference)("c5c87f63730f10b32f23532552f606c5ce927141",l),(0,s.registerServerReference)("c44f796dddee508d2690c0a56bfa35105b4ef06e",u),(0,s.registerServerReference)("3b9f5381daf25ec350eef41c4522b870a90edcf5",f),(0,s.registerServerReference)("ae096b2f57a48498d952cabcd0d481c0bea6f80f",b),(0,s.registerServerReference)("9e55bf1e1fc4c00ed7818ab82e1f39f596a869a4",p),(0,s.registerServerReference)("08893cc7b3568853778612b7009d9e0295b3d182",g),(0,s.registerServerReference)("605fbd3cfa84bd30ec8d022f83bc673e1209f363",v)},73881:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>a});var s=t(66621);let a=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,s.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]},5023:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[377,42,913,621,843],()=>t(91566));module.exports=s})();