exports.id=880,exports.ids=[880],exports.modules={13880:(e,a,t)=>{let r={"1294bc6289fb3f48ece6b2624fcf0a7159bd44a1":()=>Promise.resolve().then(t.bind(t,35592)).then(e=>e.AddSurvey),"50dadfc4330057b610d58480cf7826de26ef9cfb":()=>Promise.resolve().then(t.bind(t,35592)).then(e=>e.jsonToCsv),"5b991ea63bbb793222adafd52aa38e3d967dded3":()=>Promise.resolve().then(t.bind(t,35592)).then(e=>e.addUserResponse),"698d721765c12ab740b9a21001fb9c58fa7ab7aa":()=>Promise.resolve().then(t.bind(t,35592)).then(e=>e.getSurveyById),"72a2adeb8fd5d46dda01f64de9967841f094ace5":()=>Promise.resolve().then(t.bind(t,35592)).then(e=>e.GetSurveyResponses),"803e1e62126ed4be882fbd3e7af960204256164b":()=>Promise.resolve().then(t.bind(t,35592)).then(e=>e.GetResponseById),a45bd6869df1810050cb672200a7ccc1177008bc:()=>Promise.resolve().then(t.bind(t,35592)).then(e=>e.getUserSurveys),bc1b0a60241e1ab2d50e7b25b670761a0951a9bd:()=>Promise.resolve().then(t.bind(t,35592)).then(e=>e.getRecentSurveys),c4ad600bf022cca31ebfcf4de561635feef8bc4c:()=>Promise.resolve().then(t.bind(t,35592)).then(e=>e.getGroups),d8529ab2382711fcc0bdeace4c9ad172a39bf807:()=>Promise.resolve().then(t.bind(t,35592)).then(e=>e.createJsonFromLabels),f05d8aee3059d76935afb18d5406bb1506492ee1:()=>Promise.resolve().then(t.bind(t,35592)).then(e=>e.responsesToJson),"258046a1e3860fa89174224a272f0cdf55590a87":()=>Promise.resolve().then(t.bind(t,92153)).then(e=>e.getAllUsersToAssign),"4858cff1d6c3cbafd4219b6ca1e3648ed5c80d77":()=>Promise.resolve().then(t.bind(t,92153)).then(e=>e.userCreationFlow),"5929f08dcffcabce9ece9ec262c4d1da2aec33a2":()=>Promise.resolve().then(t.bind(t,92153)).then(e=>e.updateUserRoleMapping),"8b3bb30f46c0d6e334351cdbc6f39faf04c6bdb7":()=>Promise.resolve().then(t.bind(t,92153)).then(e=>e.getUsersFormData),a448f998d28c1535f4ba9b2d14794207c3b56e92:()=>Promise.resolve().then(t.bind(t,92153)).then(e=>e.createUser),bfb948864d3a9223fe1b23007ea4ecc247e7419e:()=>Promise.resolve().then(t.bind(t,92153)).then(e=>e.getUserFromDb),c3a6fc5c59e2081ad90a6af0191920ab22d8d718:()=>Promise.resolve().then(t.bind(t,92153)).then(e=>e.checkUserPermissionForSurvey),d16ec756617f7017d927ecb303b422c45c2b5f8f:()=>Promise.resolve().then(t.bind(t,92153)).then(e=>e.checkUserExistence),deb9a62e45009688455aa5d6d724f09a72e9c0c6:()=>Promise.resolve().then(t.bind(t,92153)).then(e=>e.getUserIdFromClerkId),ef8258559ec09924b33df9cdb206b83c322e79bf:()=>Promise.resolve().then(t.bind(t,92153)).then(e=>e.getAllUsers),f7abf20a8088752418c2e27ab26067e3f68fe53d:()=>Promise.resolve().then(t.bind(t,92153)).then(e=>e.getUserById)};async function d(e,...a){return(await r[e]()).apply(null,a)}e.exports={"1294bc6289fb3f48ece6b2624fcf0a7159bd44a1":d.bind(null,"1294bc6289fb3f48ece6b2624fcf0a7159bd44a1"),"50dadfc4330057b610d58480cf7826de26ef9cfb":d.bind(null,"50dadfc4330057b610d58480cf7826de26ef9cfb"),"5b991ea63bbb793222adafd52aa38e3d967dded3":d.bind(null,"5b991ea63bbb793222adafd52aa38e3d967dded3"),"698d721765c12ab740b9a21001fb9c58fa7ab7aa":d.bind(null,"698d721765c12ab740b9a21001fb9c58fa7ab7aa"),"72a2adeb8fd5d46dda01f64de9967841f094ace5":d.bind(null,"72a2adeb8fd5d46dda01f64de9967841f094ace5"),"803e1e62126ed4be882fbd3e7af960204256164b":d.bind(null,"803e1e62126ed4be882fbd3e7af960204256164b"),a45bd6869df1810050cb672200a7ccc1177008bc:d.bind(null,"a45bd6869df1810050cb672200a7ccc1177008bc"),bc1b0a60241e1ab2d50e7b25b670761a0951a9bd:d.bind(null,"bc1b0a60241e1ab2d50e7b25b670761a0951a9bd"),c4ad600bf022cca31ebfcf4de561635feef8bc4c:d.bind(null,"c4ad600bf022cca31ebfcf4de561635feef8bc4c"),d8529ab2382711fcc0bdeace4c9ad172a39bf807:d.bind(null,"d8529ab2382711fcc0bdeace4c9ad172a39bf807"),f05d8aee3059d76935afb18d5406bb1506492ee1:d.bind(null,"f05d8aee3059d76935afb18d5406bb1506492ee1"),"258046a1e3860fa89174224a272f0cdf55590a87":d.bind(null,"258046a1e3860fa89174224a272f0cdf55590a87"),"4858cff1d6c3cbafd4219b6ca1e3648ed5c80d77":d.bind(null,"4858cff1d6c3cbafd4219b6ca1e3648ed5c80d77"),"5929f08dcffcabce9ece9ec262c4d1da2aec33a2":d.bind(null,"5929f08dcffcabce9ece9ec262c4d1da2aec33a2"),"8b3bb30f46c0d6e334351cdbc6f39faf04c6bdb7":d.bind(null,"8b3bb30f46c0d6e334351cdbc6f39faf04c6bdb7"),a448f998d28c1535f4ba9b2d14794207c3b56e92:d.bind(null,"a448f998d28c1535f4ba9b2d14794207c3b56e92"),bfb948864d3a9223fe1b23007ea4ecc247e7419e:d.bind(null,"bfb948864d3a9223fe1b23007ea4ecc247e7419e"),c3a6fc5c59e2081ad90a6af0191920ab22d8d718:d.bind(null,"c3a6fc5c59e2081ad90a6af0191920ab22d8d718"),d16ec756617f7017d927ecb303b422c45c2b5f8f:d.bind(null,"d16ec756617f7017d927ecb303b422c45c2b5f8f"),deb9a62e45009688455aa5d6d724f09a72e9c0c6:d.bind(null,"deb9a62e45009688455aa5d6d724f09a72e9c0c6"),ef8258559ec09924b33df9cdb206b83c322e79bf:d.bind(null,"ef8258559ec09924b33df9cdb206b83c322e79bf"),f7abf20a8088752418c2e27ab26067e3f68fe53d:d.bind(null,"f7abf20a8088752418c2e27ab26067e3f68fe53d")}},35592:(e,a,t)=>{"use strict";t.r(a),t.d(a,{AddSurvey:()=>f,GetResponseById:()=>l,GetSurveyResponses:()=>o,addUserResponse:()=>u,createJsonFromLabels:()=>m,getGroups:()=>v,getRecentSurveys:()=>n,getSurveyById:()=>i,getUserSurveys:()=>b,jsonToCsv:()=>h,responsesToJson:()=>y});var r=t(24330);t(60166);var d=t(24925),s=t(98860),c=t(92153);async function n(){let e=await (0,d.C)(),a={text:`
      SELECT s.id AS survey_id, 
      s.title AS survey_title,
      s.createdat AS created_at,
      s.closes_at as closes_at,
      c.groupname as category,
      u.username AS creator_name,
      COUNT(sr.id) AS total_responses
      FROM surveys s
      LEFT JOIN surveyresponses sr ON s.id = sr.survey_id
      LEFT JOIN users u ON s.createdby = u.id
      LEFT JOIN "groups" c ON c.id = s.category
      GROUP BY s.id, s.title, s.createdat,c.groupname, u.username
      ORDER BY s.id DESC;
        `};return(await e.query(a)).rows}async function b(e){let a=await (0,d.C)(),t={text:`
    SELECT
    s.id AS survey_id,
    s.title AS survey_title,
    s.createdat AS created_at,
    s.closes_at AS closes_at,
    gr.groupname AS category,
    u.username AS creator_name
    FROM
        surveys s
    LEFT JOIN
        "userrole_mapping" urm ON urm.group_id = s.category
    LEFT JOIN
        "users" u ON u.id = urm.user_id
    LEFT JOIN
        "groups" gr ON gr.id = s.category
    WHERE
        (u.id = $1 OR s.category IS NULL)
    GROUP BY
        s.id, s.title, s.createdat, s.closes_at, gr.groupname, u.username
    ORDER BY
        s.id DESC;
      `,values:[await (0,c.getUserIdFromClerkId)(e)]};return(await a.query(t)).rows}async function f(e,a){let t=await (0,d.C)();try{console.log(e);let r=JSON.stringify(e.survey_fields),d={text:"insert into surveys (title, surveyfields, createdby, closes_at, category,survey_img) values ($1, $2, $3, $4, $5, $6)",values:[e.title,r,a,e.closes_at,e.category,e.survey_img]};console.log(d);let s=await t.query(d);return console.log(s),{status:200,statusText:`${s.command} completed successfully`,result:s}}catch(e){return{error:e,status:500,statusText:"Internal server error",message:e.message,data:null}}}async function o(e){let a=await (0,d.C)();try{let t={text:`select sr.id, u.username, sr.response_data, sr.createdat
      from surveyresponses sr 
      join users u
      on sr.user_id = u.id
      where sr.survey_id = $1; 
      `,values:[e]};return(await a.query(t)).rows}catch(e){return console.log(e),"error fetching"}}async function l(e){let a=await (0,d.C)();try{return(await a.query({text:"select * from surveyresponses where id = $1",values:[e]})).rows}catch(e){return console.log(e),"Error Fetching"}}async function i(e){let a=await (0,d.C)();try{return(await a.query({text:"select * from surveys where id = $1",values:[e]})).rows}catch(e){return console.log(e),"Error Fetching"}}async function u(e){let a=await (0,d.C)(),t=await (0,c.getUserIdFromClerkId)(e.user_id),r=JSON.stringify(e.response_data),s={text:"insert into surveyresponses (user_id, survey_id, response_data) values ($1, $2, $3)",values:[t,e.survey_id,r]};try{return await a.query(s)}catch(e){return"Error Fetching Data"}}async function m(e){let a=[],t={},r=[];return e.forEach(e=>{switch(e.label=e.label.trim(),r.push(e.label),e.type){case 0:case 1:t[e.label]=[];break;case 2:t[e.label]=[];case 5:case 3:t[e.label]=[]}}),a.push(r),a.push(t),console.log("our json !!!!",a),a}async function y(e,a,t){let r=t[1],d=t[0],c=0;for(let t of a){let a=JSON.parse(t=t.response_data);e=a[a.length-1].htmlString;let n=new s.JSDOM(e).window.document;for(let e of a)if(e.id){let a=n.querySelector(`#${e.id}`);if(a){let t,d,s,n;switch(a.type){case"text":t=(t=a.parentElement.firstChild.textContent).trim(),d=e.answer,t&&r[t]&&(r[t][c]=d);break;case"checkbox":t=(t=a.parentElement.parentElement.parentElement.firstChild.textContent).trim(),d=a.value,t&&r[t]&&(r[t][c]||(r[t][c]=[]),r[t][c].push(d));break;case"radio":s=(s=a.parentElement?.parentElement?.parentElement?.parentElement?.parentElement?.parentElement?.firstChild.textContent).trim(),n=(n=a.parentElement.parentElement.firstChild.textContent).trim(),d=a.value,t&&r[s][n]&&(r[s][n][c]=d);break;case"file":if(!e.answer){a.value="No file uploaded";continue}t=(t=a.parentElement.parentElement.firstChild.textContent).trim(),d=e.answer,t&&r[t]&&(r[t][c]=d);break;case"date":t=(t=a.parentElement.parentElement.firstChild.textContent).trim(),d=e.answer,t&&r[t]&&(r[t][c]=d);break;case"select-one":t=(t=a.parentNode.firstChild.textContent).trim(),d=e.answer,t&&r[t]&&(r[t][c]=d)}console.log("radio: ",s,"radio2",n,"JsonData ",r[s]),console.log("Label: ",t),console.log("Value: ",d)}}d.forEach(e=>{r[e][c]||(r[e][c]="n/a")}),c++}return console.log("Final JSONNNNN**********\n"),console.log(r),r}async function h(e){let a=Object.keys(e),t=a.join(",")+"\n",r=Math.max(...Object.values(e).map(e=>e.length));for(let d=0;d<r;d++)t+=a.map(a=>{let t=e[a];if(!(d<t.length))return'"n/a"';{let e=t[d];return Array.isArray(e)?`"${e.join("&")}"`:`"${e}"`}}).join(",")+"\n";return t}async function v(){let e=await (0,d.C)();return(await e.query("select * from groups")).rows}(0,t(40618).h)([n,b,f,o,l,i,u,m,y,h,v]),(0,r.j)("bc1b0a60241e1ab2d50e7b25b670761a0951a9bd",n),(0,r.j)("a45bd6869df1810050cb672200a7ccc1177008bc",b),(0,r.j)("1294bc6289fb3f48ece6b2624fcf0a7159bd44a1",f),(0,r.j)("72a2adeb8fd5d46dda01f64de9967841f094ace5",o),(0,r.j)("803e1e62126ed4be882fbd3e7af960204256164b",l),(0,r.j)("698d721765c12ab740b9a21001fb9c58fa7ab7aa",i),(0,r.j)("5b991ea63bbb793222adafd52aa38e3d967dded3",u),(0,r.j)("d8529ab2382711fcc0bdeace4c9ad172a39bf807",m),(0,r.j)("f05d8aee3059d76935afb18d5406bb1506492ee1",y),(0,r.j)("50dadfc4330057b610d58480cf7826de26ef9cfb",h),(0,r.j)("c4ad600bf022cca31ebfcf4de561635feef8bc4c",v)}};